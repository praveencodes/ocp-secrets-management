apiVersion: operators.coreos.com/v1alpha1
kind: ClusterServiceVersion
metadata:
  name: secrets-management-operator.v0.1.0
  namespace: placeholder
  annotations:
    alm-examples: |-
      [
        {
          "apiVersion": "secrets-management.openshift.io/v1alpha1",
          "kind": "SecretsManagementConfig",
          "metadata": {
            "name": "cluster"
          },
          "spec": {
            "features": {
              "delete": {
                "enabled": true,
                "checkRBAC": true
              }
            },
            "rbac": {
              "createDefaultRoles": true,
              "rolePrefix": "secrets-management"
            },
            "plugin": {
              "image": "openshift.io/ocp-secrets-management:latest",
              "replicas": 2
            },
            "operators": {
              "certManager": {
                "enabled": true
              },
              "externalSecrets": {
                "enabled": true
              },
              "secretsStoreCSI": {
                "enabled": true
              }
            }
          }
        }
      ]
    capabilities: Basic Install
    categories: Security
    containerImage: openshift.io/ocp-secrets-management-operator:v0.1.0
    createdAt: "2026-02-12T00:00:00Z"
    description: Unified console plugin for managing secrets across cert-manager, External Secrets Operator, and Secrets Store CSI Driver
    operators.operatorframework.io/builder: operator-sdk-v1.34.0
    operators.operatorframework.io/project_layout: go.kubebuilder.io/v4
    repository: https://github.com/openshift/ocp-secrets-management
    support: Red Hat
spec:
  apiservicedefinitions: {}
  customresourcedefinitions:
    owned:
      - description: SecretsManagementConfig is the configuration for the OCP Secrets Management console plugin
        displayName: Secrets Management Config
        kind: SecretsManagementConfig
        name: secretsmanagementconfigs.secrets-management.openshift.io
        version: v1alpha1
        specDescriptors:
          - description: Feature toggles for the console plugin UI
            displayName: Features
            path: features
          - description: RBAC resources managed by the operator
            displayName: RBAC
            path: rbac
          - description: Console plugin deployment settings
            displayName: Plugin
            path: plugin
          - description: Per-operator configuration
            displayName: Operators
            path: operators
        statusDescriptors:
          - description: Overall status of the deployment
            displayName: Phase
            path: phase
            x-descriptors:
              - urn:alm:descriptor:io.kubernetes.phase
          - description: Whether the plugin is ready
            displayName: Plugin Ready
            path: plugin.ready
            x-descriptors:
              - urn:alm:descriptor:text
  description: |
    ## OCP Secrets Management Console Plugin

    The OCP Secrets Management operator provides a unified OpenShift Console plugin for managing 
    secrets-related Custom Resources from multiple operators:

    * **cert-manager** - Certificates, Issuers, ClusterIssuers
    * **External Secrets Operator (ESO)** - ExternalSecrets, SecretStores, PushSecrets
    * **Secrets Store CSI Driver** - SecretProviderClasses

    ### Features

    * **Unified Dashboard** - View all secrets-related resources in one place
    * **Operator Detection** - Automatically detects which operators are installed
    * **RBAC Management** - Creates default ClusterRoles for view, delete, and admin access
    * **Flexible Configuration** - Enable/disable features and operators via CRD

    ### Prerequisites

    * OpenShift 4.18 or later
    * One or more of the supported operators installed (optional)

    ### Getting Started

    After installing the operator, create a `SecretsManagementConfig` resource:

    ```yaml
    apiVersion: secrets-management.openshift.io/v1alpha1
    kind: SecretsManagementConfig
    metadata:
      name: cluster
    spec:
      rbac:
        createDefaultRoles: true
      plugin:
        replicas: 2
    ```

    The operator will:
    1. Create default RBAC ClusterRoles
    2. Deploy the console plugin
    3. Register the plugin with OpenShift Console
    4. Detect installed operators

  displayName: OCP Secrets Management
  icon:
    - base64data: PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iIzNFOEVFRCIgZD0iTTEyIDFhMTEgMTEgMCAxIDAgMTEgMTFBMTEgMTEgMCAwIDAgMTIgMXptMCAyMGE5IDkgMCAxIDEgOS05IDkgOSAwIDAgMS05IDl6bTUtMTNoLTN2LTJhMiAyIDAgMCAwLTQgMHYySDdhMSAxIDAgMCAwLTEgMXY3YTEgMSAwIDAgMCAxIDFoMTBhMSAxIDAgMCAwIDEtMXYtN2ExIDEgMCAwIDAtMS0xem0tNS0yYTEgMSAwIDAgMSAxIDF2Mkg5di0yYTEgMSAwIDAgMSAxLTF6bTQgMTBIOHYtNWg4eiIvPjwvc3ZnPg==
      mediatype: image/svg+xml
  install:
    spec:
      clusterPermissions:
        - rules:
            - apiGroups:
                - secrets-management.openshift.io
              resources:
                - secretsmanagementconfigs
              verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
            - apiGroups:
                - secrets-management.openshift.io
              resources:
                - secretsmanagementconfigs/status
              verbs:
                - get
                - update
                - patch
            - apiGroups:
                - secrets-management.openshift.io
              resources:
                - secretsmanagementconfigs/finalizers
              verbs:
                - update
            - apiGroups:
                - apps
              resources:
                - deployments
              verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
            - apiGroups:
                - ""
              resources:
                - services
                - serviceaccounts
                - configmaps
                - namespaces
              verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
            - apiGroups:
                - rbac.authorization.k8s.io
              resources:
                - clusterroles
                - clusterrolebindings
              verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
            - apiGroups:
                - console.openshift.io
              resources:
                - consoleplugins
              verbs:
                - get
                - list
                - watch
                - create
                - update
                - patch
                - delete
            - apiGroups:
                - apiextensions.k8s.io
              resources:
                - customresourcedefinitions
              verbs:
                - get
                - list
                - watch
            - apiGroups:
                - ""
              resources:
                - events
              verbs:
                - create
                - patch
          serviceAccountName: secrets-management-operator
      deployments:
        - name: secrets-management-operator
          spec:
            replicas: 1
            selector:
              matchLabels:
                control-plane: controller-manager
                app.kubernetes.io/name: ocp-secrets-management
            template:
              metadata:
                labels:
                  control-plane: controller-manager
                  app.kubernetes.io/name: ocp-secrets-management
              spec:
                securityContext:
                  runAsNonRoot: true
                  seccompProfile:
                    type: RuntimeDefault
                serviceAccountName: secrets-management-operator
                containers:
                  - name: manager
                    image: openshift.io/ocp-secrets-management-operator:v0.1.0
                    imagePullPolicy: IfNotPresent
                    command:
                      - /manager
                    args:
                      - --leader-elect
                    ports:
                      - containerPort: 8080
                        name: metrics
                        protocol: TCP
                      - containerPort: 8081
                        name: health
                        protocol: TCP
                    livenessProbe:
                      httpGet:
                        path: /healthz
                        port: 8081
                      initialDelaySeconds: 15
                      periodSeconds: 20
                    readinessProbe:
                      httpGet:
                        path: /readyz
                        port: 8081
                      initialDelaySeconds: 5
                      periodSeconds: 10
                    resources:
                      limits:
                        cpu: 200m
                        memory: 256Mi
                      requests:
                        cpu: 100m
                        memory: 128Mi
                    securityContext:
                      allowPrivilegeEscalation: false
                      capabilities:
                        drop:
                          - ALL
                terminationGracePeriodSeconds: 10
    strategy: deployment
  installModes:
    - supported: false
      type: OwnNamespace
    - supported: false
      type: SingleNamespace
    - supported: false
      type: MultiNamespace
    - supported: true
      type: AllNamespaces
  keywords:
    - secrets
    - cert-manager
    - external-secrets
    - secrets-store-csi
    - console-plugin
    - security
  links:
    - name: Documentation
      url: https://github.com/openshift/ocp-secrets-management
    - name: cert-manager
      url: https://cert-manager.io
    - name: External Secrets Operator
      url: https://external-secrets.io
  maintainers:
    - email: support@redhat.com
      name: Red Hat
  maturity: alpha
  minKubeVersion: 1.27.0
  provider:
    name: Red Hat
    url: https://www.redhat.com
  version: 0.1.0
